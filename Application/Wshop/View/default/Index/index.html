<extend name="Public/common"/>
<block name="style">
    <link type="text/css" rel="stylesheet" href="__CSS__/public.css"/>
    <link type="text/css" rel="stylesheet" href="__CSS__/product.css"/>
</block>
<block name="body">
    <div class="wshop_topic">
        <div class="container">
            <div class="wshop_cats_box">
                <include file="Public/_cats"/>
            </div>
            
            <div class="menu">

            </div>
            <div class="wshop_my">
            <ul class="nav nav-primary">
                <volist name="menu" id="menu">
                    <li><a href="{$menu.link}">{$menu.title} <span class="label label-badge label-success">4</span></a> </li>
               </volist>
            </ul>
            </div>
            <div class="pic">
                轻量级PC+APP+微信商城解决方案
            </div>
        </div>
    </div>
    <div id="main-container" class="container">
        <div class="col-md-8">
            <div class="common_block_border">

                <div class="common_content_box">
                    <section id="contents">

                        <notempty name="list">
                            <volist name="list" id="data">
                                <div class="col-md-4">
                                    <div class="product_list_box">
                                    <a href="{:U('Wshop/index/product',array('id'=>$data['id']))}" target="_blank">
                                        <div class="img">
                                            <img alt="{$data.title|text}" src="{$data.main_img|getThumbImageById=475,475}" class="img-responsive">
                                        </div>
                                        <div class="con">
                                            <h3>{$data.title}</h3>
                                        </div>
                                    </a>
                                    <div class="doinfo clearfix">
                                        <div class="row">
                                            <div class="col-xs-6">
                                                <div class="price">价格：{$data.price}</div>
                                            </div>

                                            <div class="col-xs-6">
                                                <button 
                                                    type="button" 
                                                    class="btn btn-block btn-lg btn-primary" 
                                                    data-title="立即购买" 
                                                    data-url="{:U('index/buyexpand',array('id'=>$data['id'],'price'=>$data['price']))}" 
                                                    data-toggle="modal">
                                                    立即购买
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </volist>
                            <else/>
                            <div style="font-size:1em;padding:2em 0;color: #ccc;text-align: center">该类型下没有内容~</div>
                        </notempty>
                    </section>

                    <div class="text-center">
                        {:getPagination($totalCount,20)}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="common_block_border">
            <!--侧栏菜单-->
                <include file="Public/_nav"/>
            </div>
        </div>
    </div>
</block>
<block name="script">
<script type="text/javascript">
        $('.all-cats-list > .item').hover(function(){
            var eq = $('.all-cats-list > .item').index(this),               //获取当前滑过是第几个元素
                h = $('.all-cats-list').offset().top,                       //获取当前下拉菜单距离窗口多少像素
                s = $(window).scrollTop(),                                  //获取游览器滚动了多少高度
                i = $(this).offset().top,                                   //当前元素滑过距离窗口多少像素
                item = $(this).children('.item-list').height(),             //下拉菜单子类内容容器的高度
                sort = $('.all-cats-list').height();                        //父类分类列表容器的高度
            
            if ( item < sort ){                                             //如果子类的高度小于父类的高度
                if ( eq == 0 ){
                    $(this).children('.item-list').css('top', (i-h));
                } else {
                    $(this).children('.item-list').css('top', (i-h)+1);
                }
            } else {
                if ( s > h ) {                                              //判断子类的显示位置，如果滚动的高度大于所有分类列表容器的高度
                    if ( i-s > 0 ){                                         //则 继续判断当前滑过容器的位置 是否有一半超出窗口一半在窗口内显示的Bug,
                        $(this).children('.item-list').css('top', (s-h)+2 );
                    } else {
                        $(this).children('.item-list').css('top', (s-h)-(-(i-s))+2 );
                    }
                } else {
                    $(this).children('.item-list').css('top', 3 );
                }
            }   

            $(this).addClass('hover');
            $(this).children('.item-list').css('display','block');
        },function(){
            $(this).removeClass('hover');
            $(this).children('.item-list').css('display','none');
        });

        $('.item > .item-list > .close').click(function(){
            $(this).parent().parent().removeClass('hover');
            $(this).parent().hide();
        });
    </script>


</block>